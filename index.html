<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Quarkus Tutorial</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/dracula.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/zenburn.css">
		<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
	</head>
	<style>
			.ciao{
				background-size: contain;
			}
	</style>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown data-background-image="assets/blwallpaper_dark.png" 
				data-background-size="contain" data-background-repeat="no-repeat">
				<script type="text/template">
						![](./assets/quakuslogodark.png)

						&nbsp;  
						A cura di Davide Galati (in arte PsykeDady)<!-- .element class="text-start h5 text-white-50 m-5"-->  
						davide.galati@brainylabs.it<!-- .element class="text-start h5 text-white-50 m-5"-->  
						psdady@msn.com<!-- .element class="text-start h5 text-white-50 m-5"-->  
					</script>
				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Link e info presentazione

					- Potete trovare la presentazione all'indirizzo [quarkustutorialrevealjs.surge.sh](http://quarkustutorialrevealjs.surge.sh)
					- Con il tasto ESC avrete una panoramica di tutte le slide (*non fatevi spoiler per√≤!*)
					- Aggiungendo [?print-pdf](http://quarkustutorialrevealjs.surge.sh) all'indirizzo potrete avere una versione da stampare come pdf (dopo averla aperta stampate la pagina col browser).
					- Potete trovare il codice della presentazione sulla mia pagina di Github principale https://github.com/PsykeDady/QuarkusTutorialRevelis
					- La presentazione si estende in *orizzontale* ma anche in **verticale**! Fare attenzione alle frecce <u>a sinistra in basso</u>.
					- I codici presenti son disponibili sul [mio Github personale](https://github.com/PsykeDady/QuarkusTest) (verranno presto trasferiti anche su quello di Brainy Labs).
				</section>

				<section>					
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Cos'√®
						> *What we mean by "Supersonic Subatomic Java".*  
						> ~[Sito quarkus, sezione about](https://quarkus.io/about/)  
	
						Mentre l'innovazione tecnologica verte sullo sviluppo di applicazioni a micro servizi, lo stack tecnologico Java tradizionalmente √® formato da applicazioni monolitiche in genere molto pesanti 
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Cos'√®
						![](assets/microservices-logical.png)
					</section>
				</section>
								
				<section>
					<section data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						<h3>Cos'√®</h3>
						<small>Quarkus √® un framework full REST creato per consentire agli sviluppatori Java di creare applicazioni orientate al mondo cloud</small>
						<img src="assets/quarkus-cloud.png" class="r-stretch">
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Cos'√®
						Nel farlo crea, a partire da un sorgente Java, un binario nativo per il sistema con le librerie incluse
						![](assets/javaquarkusbinary.png)
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Cos'√®
						- Resta comunque da dire che Quarkus **non √® un framework limitato al cloud**.
						- La struttura di un progetto quarkus non ha differenze rilevanti rispetto a quelle di un progetto Spring o un normale progetto Maven
						- N√© risulta diversa la messa in produzione o il funzionamento (*tranne per la portabilit√† che potrebbe risentirne*).
						- Grazie alla compilazione nativa risulta comunque un processo ottimizzato
					</section>
				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Howto
					Per creare un progetto di quarkus si pu√≤ seguire [il tutorial ufficiale](https://quarkus.io/get-started/).  
					I prerequisiti sono fondamentalmente:
					  - Installare Java GraalVM (seguire istruzioni da sito)
					  - Installare Quarkus cli
					  - Docker (per testare il caso pi√π verosimilmente possibile)
				</section>

				<section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Howto - Installare Quarkus cli

						Da terminale UNIX eseguire: 

						```bash
						curl -Ls https://sh.jbang.dev | bash -s - trust add https://repo1.maven.org/maven2/io/quarkus/quarkus-cli/
						```

						Quindi scrivere:
						```bash
						curl -Ls https://sh.jbang.dev | bash -s - app install --fresh --force quarkus@quarkusio
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Howto - Installare Quarkus cli (Windows)

						Per installare il tool su Windows √® consigliato uno dei seguenti software per emulare l'ambiente UNIX:
						
						- [WSL](https://learn.microsoft.com/it-it/windows/wsl/install)
						- [Cygwin](https://www.cygwin.com) 
						- [MinGW](https://sourceforge.net/projects/mingw/)
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Howto - Installare Quarkus cli (Windows Powershell)

						Si pu√≤ eventualmente utilizzare powershell scrivendo:
						
						```batch
						iex "& { $(iwr https://ps.jbang.dev) } trust add https://repo1.maven.org/maven2/io/quarkus/quarkus-cli/"
						iex "& { $(iwr https://ps.jbang.dev) } app install --fresh --force quarkus@quarkusio"
						```
					</section>
				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Strumenti/IDE

					- Quarkus √® un framework relativamente nuovo (**~2019**), ma comunque supportato da alcuni IDE.
					- √à possibile consultare sul sito stesso [la lista degli IDE e delle relative estensioni](https://quarkus.io/guides/ide-tooling).
					
					> Nota del presentatore: 
					> 
					> Personalmente utilizzo ed ho testato solo il plugin di Visual Studio Code.  
					> Nella presentazione sar√† quindi mostrato quello.
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						<script type="text/template">
							### Visual Studio Code - estensioni
						
							- √à possibile installare l'estensione per quarkus di Visual Studio Code direttamente dall'IDE utilizzando l'apposito men√π <!--.element class="small"-->

							![](assets/vscode_quarkus_ext.png) <!-- .element class="col-10"-->
						</script>
					</section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						<script type="text/template">
							### Visual Studio Code - estensioni

							- Trattandosi di un framework scritto in java √® consigliabile comunque utilizzare tutto il set di estensioni di base di RedHat per Java.
							- Una volta installata saranno possibili diverse opzioni.
							- Per visualizzare aprire il control panel (CTRL+Shift+P su Win/Linux, Cmd+Shift+P su Mac).
							- Una volta aperto cercare "Quarkus" per vedere le azioni disponibili

							![](assets/vscode_quarkus_ext_controlpanel.png) <!-- .element class="col-6"-->
						</script>
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Visual Studio Code - estensioni

						- In generale, l'opzione pi√π utile √® sicuramente quella per fare il DEBUG e l'esecuzione del progetto.
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Creare un progetto Quarkus

						- Una volta installato il progetto √® necessario semplicemente scrivere:

						```bash
						quarkus create
						```

						- Il tool creer√† in maniera totalmente autonoma il progetto, dentro cui sar√† poi possibile navigare.
						
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Creare un progetto Quarkus

						- A fine esecuzione si potr√† leggere:

						```
						-----------

						applying codestarts...
						üìö java
						üî® maven
						üì¶ quarkus
						üìù config-properties
						üîß tooling-dockerfiles
						üîß tooling-maven-wrapper
						üöÄ resteasy-reactive-codestart

						-----------
						[SUCCESS] ‚úÖ  quarkus project has been successfully generated in:
						--> /home/SharedFiles/code-with-quarkus
						-----------
						Navigate into this directory and get started: quarkus dev

						```

						- Nell'ultima riga si pu√≤ leggere l'istruzione per far partire il progetto.
						
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						<script type="text/template">
							### Un occhiata alla struttura del progetto...

							- Aprendo il progetto la cosa sicuramente pi√π evidente √® una grande pulizia nella struttura stessa. <!-- .element: class="small" -->
							
							![](assets/quarkus_project_tree.png) <!-- .element: class="col-8" -->

						</script>
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Un occhiata alla struttura del progetto...
					
					- I punti di interesse maggiori son sicuramente: 
						- `pom.xml`
						- `src/main/java/org/acme/GreetingResource.java` che rappresenta un primo endpoint di esempio
					- Il pom fa riferimento al groupid `org.acme` e artifactID `code-with-quarkus`. 
					- Questi valori ovviamente possono essere cambiati sostituendo quelli della propria organizazzione nonch√© del nome del progetto
					- Di conseguenza pu√≤ essere cambiato/creato anche il package per la classe Java
						
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Un ~~"ping"~~ bring test

						- Per iniziare con un attivit√† semplice e vedere il funzionamento del proprio del progetto si pu√≤ personalizzare la classe `GreetingResouce`.
						- Ad esempio modificando package e contenuto dell'Hello World.
						- Si pu√≤ notare una struttura simile agli applicativi Spring, ma ancora di pi√π ai server JAX-RS
							- Ad esempio il path del Controller √® dato dall'annotazione `@Path`
							- La tipologia di metodo HTTP utilizzato √® dato dall'annotazione `@GET`
							- Il tipo di risultato restituito √® specificato dal tipo di ritorno `String`, ma anche dall'annotazione `@Produces(MediaType.TEXT_PLAIN)`
						- Cambiamo anche nome del metodo e path API del controller: 

						```java
						@Path("/bring")
						public class BringTest {
						
							@GET
							@Produces(MediaType.TEXT_PLAIN)
							public String bring() {
								return "Bang Bang Born";
							}
						}
						```
						
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						<script type="text/template">
							### Un ~~"ping"~~ bring test
						
							Ecco il risultato: <!--.element class="text-start"-->

							![](assets/bingbangbangborn_example.png) <!--.element class="col-8"-->
						</script>
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### POST e jackson

						- Quarkus resta comunque un po' meno immediato rispetto a **spring**. Alcune configurazioni iniziali potrebbero non essere immediate per chi viene da quel mondo
						- Ad esempio, per fare chiamate POST e trattare con JSON va importata la dipendenza di jackson ma per quarkus: 

						```xml
						<dependency>
							<groupId>io.quarkus</groupId>
							<artifactId>quarkus-rest-jackson</artifactId>
						</dependency>					  
						```
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Compilare ed avviare il progetto
						
						Essendo un progetto maven, per compilare un progetto quarkus √® sufficiente il comando 

						```bash
						mvn clean install
						```

					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Compilare ed avviare il progetto
						
						L'avvio del progetto √® ottenibile in due diversi modi. Tramite maven:

						```bash
						mvn quarkus:dev
						```

						Oppure tramite quarkus cli: 
						```bash
						quarkus dev
						```
					</section>
				</section>

				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Build nativa
						
						- Uno dei punti focali che distingue Quarkus dalle alternative √® la compilazione nativa
						- Le build native perdono poi in portabilit√†, tuttavia tramite meccanismi di containerizzazione si pu√≤ ovviare facilmente
						- All'infuori dei sistemi operativi Linux-based la build nativa potrebbe incontrare alcuni scogli iniziali
						- La build nativa necessita GraalVM e compilatore C
					</section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Build nativa (Windows)
						
						- L'installazione di quarkus su Windows necessita che sia [installato VCRedist](https://learn.microsoft.com/it-it/cpp/windows/latest-supported-vc-redist?view=msvc-170)
						- Una volta installato, quarkus deve essere eseguito solo dopo aver eseguito l'eseguibile **vcvars64**
						- Il processo diventa quindi meno automatizzato e pi√π tedioso (ma comunque possibile).

					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Build nativa
						Per generare una build nativa: 
						```bash
						quarkus build --native
						```
						
						Un alternativa valida √® usare maven: 

						```bash
						mvn package -Dnative
						```

						Da windows (Powershell): 
						
						```batch
						cmd /c 'call "C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvars64.bat" & quarkus build --native '
						```
						Oppure usare l'eseguibile locale di maven (che inizializza le vcvars):
						```batch
						./mvnw package -Dnative
						```
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Build nativa

						Alcune note a margine:  
						
						- Se un progetto quarkus funziona alla perfezione con una build locale, **non implica il funzionamento in nativo**.
						- ci potrebbero essere alcuni problemi legati a librerie non pienamente compatibili o notazioni/funzioni mancanti ma necessarie alla build nativa.
						- Esistono due articoli ufficiali ([qui](https://quarkus.io/guides/writing-native-applications-tips) e [qui](https://quarkus.io/guides/building-native-image)) per lo sviluppo di applicazioni native.
						- Le classi modello o in cui vengono utilizzate tecniche di **reflection** (si pensi a jackson) vanno segnate con `@RegisterForReflection`
						- -
					</section>
				</section>

				<section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						- Come in ogni altro progetto maven, pu√≤ essere creata la suite di test da eseguire alle install o build.
						- Quarkus viene scaricato gi√† con dipendenze: `junit` e `rest-assured`
						- Il progetto contiene gi√† alcuni test di esempio
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						- L'annotazione `@QuarkusTest` introduce ad una classe di Test 
						- L'annotazione `@Test` ad uno specifico test.
						
						```java
						@QuarkusTest
						class GreetingResourceTest {

							@Test
							void assertTautologia () {
								assertTrue(true);
							}

						}
						```

					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						
						- Tramite rest-assured √® possibile testare le chiamate API
						- Tramite il metodo `given` si crea un builder che rappresenta la chiamata
						- si pu√≤ specificare l'azione del protocollo HTTP da usare, lo status code atteso ed il body ricevuto

						```java
						@Test
						void testHelloEndpoint() {
							given()
							.when().get("/bring")
							.then()
								.statusCode(200)
								.body(is("Bang Bang Born"));
						}
						```


					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						- Per avviare i test si pu√≤ usare il client di quarkus
						```bash
						quarkus test
						```
						- Una volta terminati si possono "riavviare" premendo solo `r`. Oppure terminare premendo `q`
						- Anche il comando `dev` del client pu√≤ avviare i test.
						```bash
						quarkus dev
						```
						- premere il tasto `r` per i test, `q` per chiudere.

					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						
						- L'annotazione `@QuarkusIntegrationTest` √® invece utilizzata per effettuare test sul prodotto di una build.
						- √à utilizzata soprattutto per testare le esecuzioni di build native, di un container o simili.
						- Non mischiare `QuarkusTest` e `QuarkusIntegrationTest`. Il primo viene utilizzato in contesti dove l'esecuzione di surefire √® certa.
						- `@Inject` non √® supportato da `QuarkusIntegrationTest`


					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						- Per il Mock durante i test si pu√≤ utilizzare `mockito`.
						- Aggiungere quindi la dipendenza

						```xml
						&lt;dependency&gt;
							&lt;groupId&gt;io.quarkus&lt;/groupId&gt;
							&lt;artifactId&gt;quarkus-junit5-mockito&lt;/artifactId&gt;
							&lt;version&gt;3.10.0&lt;/version&gt;
						&lt;/dependency&gt;
						```

						- Importare la classe: 
						```java
						import org.mockito.Mockito;
						```

					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						Supponendo di complicare un po' la struttura del "bringTest" introducendo un Service:

						```java
						@ApplicationScoped
						public class BringService {
							
							@Inject
							BringRepository bringRepository; 

							public String getBringService () {
								return bringRepository.bringString();
							}
						}
						```

						- Ed un repository :

						```java
						@ApplicationScoped
						public class BringRepository {
							public String bringString() {
								return "Bang Bang Born";
							}
						}
						```
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Test
						
						- √à ora possibile testare il mock

						```java
						@QuarkusTest
						class MockTest {
							
							@Inject
							BringService bringService;
						
							@InjectMock
							BringRepository bringRepository;
						
							@Test
							void mockTestHello () {
								Mockito.when(bringRepository.bringString()).thenReturn("Bang Bang Born");
						
								assertEquals(bringService.getBringService(), "Bang Bang Born");
							}
						}
						```

					</section>

				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Maven e dipendenze

					- √à possibile agganciare svariate dipendenze tramite maven ad un progetto Quarkus.
					- Ad esempio si pu√≤ creare un controller per garantire le operazioni CRUD su una risorsa tramite DB.
					- Tramite `application.property` √® possibile impostare i vari parametri di connessione
				</section>

				<section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
	
						- Ogni Database ha i suoi driver ed i suoi parametri. Pi√π info sulla guida [ufficiale](https://quarkus.io/guides/datasource).
						- Aggiungiamo le dipendenze per un database *in-file* `h2`.
						```xml
						&lt;dependency&gt;
							&lt;groupId&gt;io.quarkus&lt;/groupId&gt;
							&lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;
						&lt;/dependency&gt;
						&lt;dependency&gt;
							&lt;groupId&gt;io.quarkus&lt;/groupId&gt;
							&lt;artifactId&gt;quarkus-jdbc-h2&lt;/artifactId&gt;
						&lt;/dependency&gt;
						&lt;dependency&gt;
							&lt;groupId&gt;io.quarkus&lt;/groupId&gt;
							&lt;artifactId&gt;quarkus-hibernate-validator&lt;/artifactId&gt;
						&lt;/dependency&gt;
						```
					</section>
					
					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
					
						- Aggiungiamo sull'application property le propriet√†: 
						```properties
						quarkus.datasource.db-kind=h2
						quarkus.datasource.username=quarkus_test
						quarkus.datasource.password=quarkus_test
						quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb
						quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect
						quarkus.hibernate-orm.database.generation=drop-and-create
						quarkus.hibernate-orm.log.sql=true
						```
					</section>


					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example

						- Per test costruiamo una catena Repository&arr;Service&arr;Constroller per gestire un utente.
						- Modello (usando `lombok`): 
						```java
						@Data
						@Builder
						@EqualsAndHashCode
						@AllArgsConstructor
						@NoArgsConstructor
						@RegisterForReflection
						@Entity
						public class UserEntity {
							@Id
							private String username;
							private String email; 
							private String psk;
						}						
						```
						
						- Similmente viene preparata una Response (`UserResponse`) e un Mapper (`UserMapper`).
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
	
						- Viene preparato quindi un Repository 

						```java
						@ApplicationScoped
						public class UserRepository {
						
							@Inject
							private EntityManager entityManager; 
							
							@Transactional
							public void addUser(UserEntity u) {
								entityManager.persist(u);
							}
						
							public List<UserEntity> listAll(){
								Query q= entityManager.createQuery("SELECT u FROM UserEntity u"); 
								List<UserEntity> u = new LinkedList<>(); 
								try {
									List<?> tmpL =q.getResultList();
									tmpL.forEach(v-> {if(v instanceof UserEntity) u.add((UserEntity)v);});
								} catch (Exception e) {
									e.printStackTrace();
									throw e;
								}
								return u;
							}
						
							public UserEntity getUser (String username) {
								return entityManager.find(UserEntity.class, username);
							}
						
							@Transactional
							public void updateUser (UserEntity userEntity) {
								entityManager.merge(userEntity);
							}
						
							@Transactional
							public void deleteUser (UserEntity userEntity) {
								entityManager.remove(entityManager.contains(userEntity)? userEntity : entityManager.merge(userEntity));
							}
						}
						```
						

					</section>

					<section  data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						<h3> H2 Example </h3>

						<ul>
							<li>Le query vengono fatte con <b>entityManager</b> e <b>HQL</b>.</li>
						</ul>
						<pre><code lang="java" data-line-numbers="2">public List&lt;UserEntity&gt; listAll(){
Query q= entityManager.createQuery("SELECT u FROM UserEntity u"); 
List&lt;UserEntity&gt; u = new LinkedList&lt;&gt;(); 
try {
	List&lt;?&gt; tmpL =q.getResultList();
	tmpL.forEach(v-> {if(v instanceof UserEntity) u.add((UserEntity)v);});
} catch (Exception e) {
	e.printStackTrace();
	throw e;
}
return u;
}</code></pre>
						<ul>
							<li>Alcuni metodi permettono di fare query senza l'inserimento di HQL tramite metodi gi√† predisposti.</li>
							<li>I metodi incaricati di modificare il database son contrassegnati con <code>@Transactional</code>.</li>
						</ul>
						<pre><code data-line-numbers="3">@Transactional
public void addUser(UserEntity u) {
	entityManager.persist(u);
}
						</code></pre>

						<ul>
							<li>La rimozione di una riga necessita che si controlli se esiste o no.</li>
						</ul>
						<pre><code data-line-numbers="3">@Transactional
public void deleteUser (UserEntity userEntity) {
	entityManager.remove(entityManager.contains(userEntity)? userEntity : entityManager.merge(userEntity));
}
						</code></pre>
						
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
	
						- Viene quindi messo in piedi il servizio che richiama il repository 
						```java
						@ApplicationScoped
						public class UserService {
							@Inject
							private UserRepository userRepository;
							public void addUser(UserResponse u) {...}
							public List&lt;UserResponse&gt; listUsers () {...}
							public UserResponse getUser(String username) {...}
							public void updateUser (UserResponse user){...}
							public void deleteUser (UserResponse user) {...}
						}
						```
						- Il servizio richiama semplicemente il DAO mappando le Respose in entity e viceversa.
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
	
						- Infine il Controller 

						```java
						@Path("/user")
						@Produces("application/json")
						@Consumes("application/json")
						public class UserController {
							@Inject
							private UserService userService;
							@POST
							public Response addUser( UserResponse u) {}
							@GET
							@Path("list")
							public List<UserResponse> listUsers () {}
							@GET
							@Path ("{username}")
							public UserResponse getUser (@RestPath String username) {}
							@DELETE
							public Response deleteUser (UserResponse userResponse) {}
							@PUT
							public Response updateUser (UserResponse userResponse) {}
						}
						```

						- Annotazioni come `@Path`, `@GET`, `@POST` etc.. son molto intuitive
					</section>

					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
						data-background-size="contain" data-background-repeat="no-repeat">
						### H2 Example
	
						- Si possono quindi fare quindi i test tramite POSTMAN/cUrl

						![](assets/h2test.png)
					</section>
				</section>


				<section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						### Gestione eccezioni
						- Nell'esempio precedente si √® fatto anche uso della gestione delle eccezioni.
						- Nel caso in cui vengano richiesti i dati di un utente che non esiste, viene lanciata un eccezione di tipo `import jakarta.ws.rs.NotFoundException;`.
						
						```java
						public UserResponse getUser(String username) {
							UserEntity user = userRepository.getUser(username); 
							if(user==null) {
								throw new NotFoundException("User "+username+" not found");
							}
							return UserMapper.entityToResponse(user);
						}
						```
					</section>
					<section data-markdown data-background-image="assets/blwallpaper_dark_down.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Gestione eccezioni
						- Un controller intercetta l'eccezione e restituisce un messaggio pi√π pulito ed una risposta con stato 404.
						```java
						@Provider
						public class NotFoundExceptionInterceptor implements ExceptionMapper&lt;NotFoundException&gt; {
							@Override
							public Response toResponse(NotFoundException exception) {
								return Response.status(Status.NOT_FOUND).entity(exception.getMessage()).build();
							}
						}
						```
						- Si pu√≤ ovviamente usare il messaggio dell'errore oppure modificarlo.
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Gestione Eccezioni
						- Ecco a schermo il risultato

						![](assets/user_not_found.png)
					</section>
				</section>

				<section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Altri DB e file di import delle query
						code . 
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Altri DB e file di import delle query
						
					</section>
				</section>


				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Quarkus VS Spring (Springboot)

					- application property
					- cache 
					- annotazioni
					- estendibilit√†
					- hot reload di base
					

				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					## The End 

					![](assets/thanks.jpeg)  (T.hanks)
				</section>

				<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
					### Slide semplice
				</section>

				<section>
					<section data-background-image="assets/blwallpaper_dark_down.png" 
          data-background-size="contain" data-background-repeat="no-repeat">
						<h3>Slide innestata1</h3>
						
					</section>
					<section  data-markdown data-background-image="assets/blwallpaper_dark_right.png" 
					data-background-size="contain" data-background-repeat="no-repeat">
						### Slide innestata 2
						
					</section>
				</section>

			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/

			// // Change the size of our presentation
			// document.querySelector( '.reveal' ).style.width = '1920px';
			// document.querySelector( '.reveal' ).style.height = '1080px';

			Reveal.initialize({

				// Display presentation control arrows
				controls: false,

				// Help the user learn the controls by providing hints, for example by
				// bouncing the down arrow when they first encounter a vertical slide
				controlsTutorial: false,

				// Determines where controls appear, "edges" or "bottom-right"
				controlsLayout: 'bottom-right',

				// Visibility rule for backwards navigation arrows; "faded", "hidden"
				// or "visible"
				controlsBackArrows: 'faded',

				// Display a presentation progress bar
				progress: true,

				// Display the page number of the current slide
				// - true:    Show slide number
				// - false:   Hide slide number
				//
				// Can optionally be set as a string that specifies the number formatting:
				// - "h.v":   Horizontal . vertical slide number (default)
				// - "h/v":   Horizontal / vertical slide number
				// - "c":   Flattened slide number
				// - "c/t":   Flattened slide number / total slides
				//
				// Alternatively, you can provide a function that returns the slide
				// number for the current slide. The function should take in a slide
				// object and return an array with one string [slideNumber] or
				// three strings [n1,delimiter,n2]. See #formatSlideNumber().
				slideNumber: false,

				// Can be used to limit the contexts in which the slide number appears
				// - "all":      Always show the slide number
				// - "print":    Only when printing to PDF
				// - "speaker":  Only in the speaker view
				showSlideNumber: 'all',

				// Use 1 based indexing for # links to match slide number (default is zero
				// based)
				hashOneBasedIndex: false,

				// Add the current slide number to the URL hash so that reloading the
				// page/copying the URL will return you to the same slide
				hash: true,

				// Flags if we should monitor the hash and change slides accordingly
				respondToHashChanges: true,

				// Enable support for jump-to-slide navigation shortcuts
				jumpToSlide: true,

				// Push each slide change to the browser history.  Implies `hash: true`
				history: true,

				// Enable keyboard shortcuts for navigation
				keyboard: true,

				// Optional function that blocks keyboard events when retuning false
				//
				// If you set this to 'focused', we will only capture keyboard events
				// for embedded decks when they are in focus
				keyboardCondition: null,

				// Disables the default reveal.js slide layout (scaling and centering)
				// so that you can use custom CSS layout
				disableLayout: false,

				width: 1920,
				height: 1080,

				// Bounds for smallest/largest possible scale to apply to content
				minScale: 0.5,
				maxScale: 2,

				// Enable the slide overview mode
				overview: true,

				// Vertical centering of slides
				center: true,

				// Enables touch navigation on devices with touch input
				touch: true,

				// Loop the presentation
				loop: false,

				// Change the presentation direction to be RTL
				rtl: false,

				// Changes the behavior of our navigation directions.
				//
				// "default"
				// Left/right arrow keys step between horizontal slides, up/down
				// arrow keys step between vertical slides. Space key steps through
				// all slides (both horizontal and vertical).
				//
				// "linear"
				// Removes the up/down arrows. Left/right arrows step through all
				// slides (both horizontal and vertical).
				//
				// "grid"
				// When this is enabled, stepping left/right from a vertical stack
				// to an adjacent vertical stack will land you at the same vertical
				// index.
				//
				// Consider a deck with six slides ordered in two vertical stacks:
				// 1.1    2.1
				// 1.2    2.2
				// 1.3    2.3
				//
				// If you're on slide 1.3 and navigate right, you will normally move
				// from 1.3 -> 2.1. If "grid" is used, the same navigation takes you
				// from 1.3 -> 2.3.
				navigationMode: 'default',

				// Randomizes the order of slides each time the presentation loads
				shuffle: false,

				// Turns fragments on and off globally
				fragments: true,

				// Flags whether to include the current fragment in the URL,
				// so that reloading brings you to the same fragment position
				fragmentInURL: true,

				// Flags if the presentation is running in an embedded mode,
				// i.e. contained within a limited portion of the screen
				embedded: false,

				// Flags if we should show a help overlay when the question-mark
				// key is pressed
				help: true,

				// Flags if it should be possible to pause the presentation (blackout)
				pause: true,

				// Flags if speaker notes should be visible to all viewers
				showNotes: false,

				// Global override for autolaying embedded media (video/audio/iframe)
				// - null:   Media will only autoplay if data-autoplay is present
				// - true:   All media will autoplay, regardless of individual setting
				// - false:  No media will autoplay, regardless of individual setting
				autoPlayMedia: null,

				// Global override for preloading lazy-loaded iframes
				// - null:   Iframes with data-src AND data-preload will be loaded when within
				//           the viewDistance, iframes with only data-src will be loaded when visible
				// - true:   All iframes with data-src will be loaded when within the viewDistance
				// - false:  All iframes with data-src will be loaded only when visible
				preloadIframes: null,

				// Can be used to globally disable auto-animation
				autoAnimate: true,

				// Optionally provide a custom element matcher that will be
				// used to dictate which elements we can animate between.
				autoAnimateMatcher: null,

				// Default settings for our auto-animate transitions, can be
				// overridden per-slide or per-element via data arguments
				autoAnimateEasing: 'ease',
				autoAnimateDuration: 1.0,
				autoAnimateUnmatched: true,

				// CSS properties that can be auto-animated. Position & scale
				// is matched separately so there's no need to include styles
				// like top/right/bottom/left, width/height or margin.
				autoAnimateStyles: [
					'opacity',
					'color',
					'background-color',
					'padding',
					'font-size',
					'line-height',
					'letter-spacing',
					'border-width',
					'border-color',
					'border-radius',
					'outline',
					'outline-offset'
				],

				// Controls automatic progression to the next slide
				// - 0:      Auto-sliding only happens if the data-autoslide HTML attribute
				//           is present on the current slide or fragment
				// - 1+:     All slides will progress automatically at the given interval
				// - false:  No auto-sliding, even if data-autoslide is present
				autoSlide: 0,

				// Stop auto-sliding after user input
				autoSlideStoppable: true,

				// Use this method for navigation when auto-sliding (defaults to navigateNext)
				autoSlideMethod: null,

				// Specify the average time in seconds that you think you will spend
				// presenting each slide. This is used to show a pacing timer in the
				// speaker view
				defaultTiming: null,

				// Enable slide navigation via mouse wheel
				mouseWheel: false,

				// Opens links in an iframe preview overlay
				// Add `data-preview-link` and `data-preview-link="false"` to customise each link
				// individually
				previewLinks: false,

				// Exposes the reveal.js API through window.postMessage
				postMessage: true,

				// Dispatches all reveal.js events to the parent window through postMessage
				postMessageEvents: false,

				// Focuses body when page changes visibility to ensure keyboard shortcuts work
				focusBodyOnPageVisibilityChange: true,

				// Transition style
				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Transition speed
				transitionSpeed: 'default', // default/fast/slow

				// Transition style for full page slide backgrounds
				backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom

				// The maximum number of pages a single slide can expand onto when printing
				// to PDF, unlimited by default
				pdfMaxPagesPerSlide: Number.POSITIVE_INFINITY,

				// Prints each fragment on a separate slide
				pdfSeparateFragments: true,

				// Offset used to reduce the height of content within exported PDF pages.
				// This exists to account for environment differences based on how you
				// print to PDF. CLI printing options, like phantomjs and wkpdf, can end
				// on precisely the total height of the document whereas in-browser
				// printing has to end one pixel before.
				pdfPageHeightOffset: -1,

				// Number of slides away from the current that are visible
				viewDistance: 3,

				// Number of slides away from the current that are visible on mobile
				// devices. It is advisable to set this to a lower number than
				// viewDistance in order to save resources.
				mobileViewDistance: 2,

				// The display mode that will be used to show slides
				display: 'block',

				// Hide cursor if inactive
				hideInactiveCursor: true,

				// Time before the cursor is hidden (in ms)
				hideCursorTime: 5000,

				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});					
			// Make reveal.js aware of the size change
			Reveal.layout();
		</script>
	</body>
</html>
